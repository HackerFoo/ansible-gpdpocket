---
- name: install ubuntu casper packages (iso creation = yes)
  apt: name="{{ item }}"
  with_items:
  - casper
  - lupin-casper
  when: ansible_facts.chroot == 'true' and ansible_distribution == 'Ubuntu'
  tags:
  - boot

- name: create loop module config (iso creation = yes)
  lineinfile:
    path: /etc/modprobe.d/loop.conf
    line: "options loop max_loop=8"
    create: yes
  when: ansible_facts.chroot == 'true'
  tags:
  - boot

- name: add modules to initramfs
  lineinfile:
    path: /etc/initramfs-tools/modules
    line: "{{ item }}"
    create: yes
  with_items:
  - loop
  - overlay
  - pwm-lpss
  - pwm-lpss-platform
  - squashfs
  notify:
  - update boot
  tags:
  - boot